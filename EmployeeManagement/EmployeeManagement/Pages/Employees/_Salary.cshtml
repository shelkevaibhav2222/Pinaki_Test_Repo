@model EmployeeManagement.Pages.Employees.SalaryListViewModel
@{
    Layout = null;
}

@if (Model.TotalCount == 0)
{
    <div class="alert alert-warning alert-dismissible">
        <i class="fas fa-exclamation-triangle"></i> 
        <strong>No salary records found</strong> - No salary records added for this employee in the current year.
        <div class="mt-2">
            <a href="/Employees/AddSalary" class="btn btn-sm btn-warning">
                <i class="fas fa-plus"></i> Add Salary Record Now
            </a>
        </div>
    </div>
}
else
{
    <!-- Salary Summary -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h6 class="card-title text-muted">Total Salary (Year)</h6>
                    <h3 class="text-success">@Model.TotalAmount.ToString("C")</h3>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h6 class="card-title text-muted">Total Records</h6>
                    <h3 class="text-primary">@Model.TotalCount</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Salary Records Table -->
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-success">
                <tr>
                    <th><i class="fas fa-hashtag"></i> ID</th>
                    <th><i class="fas fa-calendar"></i> Date</th>
                    <th><i class="fas fa-dollar-sign"></i> Amount</th>
                    <th><i class="fas fa-clock"></i> Created Date</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var salary in Model.Salaries)
                {
                    <tr>
                        <td><span class="badge bg-secondary">@salary.Id</span></td>
                        <td>
                            <strong>@salary.SalaryDate.ToString("dd/MM/yyyy")</strong>
                        </td>
                        <td>
                            <strong class="text-success fs-5">@salary.Amount.ToString("C")</strong>
                        </td>
                        <td>
                            <small class="text-muted">@salary.CreatedDate.ToString("dd MMM yyyy HH:mm")</small>
                        </td>
                    </tr>
                }
            </tbody>
            <tfoot class="table-light fw-bold">
                <tr>
                    <td colspan="2">Total Salary (Year)</td>
                    <td class="text-primary">@Model.TotalAmount.ToString("C")</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>

    @if (Model.TotalCount > Model.PageSize)
    {
        <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="text-muted">
                Page @Model.CurrentPage of @Model.TotalPages
            </div>
            <nav>
                <ul class="pagination pagination-sm mb-0">
                    <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                        <button type="button" class="page-link" onclick="window.loadSalaryRecords(@Model.EmployeeId, @(Model.CurrentPage - 1))">Prev</button>
                    </li>
                    @for (var i = 1; i <= Model.TotalPages; i++)
                    {
                        <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                            <button type="button" class="page-link" onclick="window.loadSalaryRecords(@Model.EmployeeId, @i)">@i</button>
                        </li>
                    }
                    <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                        <button type="button" class="page-link" onclick="window.loadSalaryRecords(@Model.EmployeeId, @(Model.CurrentPage + 1))">Next</button>
                    </li>
                </ul>
            </nav>
        </div>
    }

    <!-- Action Buttons -->
    <div class="mt-4 d-flex gap-2">
        <a href="/Employees/AddSalary" class="btn btn-success btn-sm">
            <i class="fas fa-plus"></i> Add New Salary Record
        </a>
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">
            <i class="fas fa-times"></i> Close
        </button>
    </div>

    <script>
        // Fallback: in case this partial is rendered outside Employees/Index
        window.loadSalaryRecords = window.loadSalaryRecords || function (id, page) {
            var container = document.getElementById('salaryContent');
            if (!container) return;

            container.innerHTML = '<div class="spinner-border"><span class="visually-hidden">Loading...</span></div>';
            fetch('/Employees/GetSalaryPartial?id=' + encodeURIComponent(id) + '&pageNumber=' + encodeURIComponent(page), { cache: 'no-store' })
                .then(function (r) { return r.text(); })
                .then(function (html) { container.innerHTML = html; })
                .catch(function () { container.innerHTML = '<div class="alert alert-danger">Error loading salary data</div>'; });
        };
    </script>
}
